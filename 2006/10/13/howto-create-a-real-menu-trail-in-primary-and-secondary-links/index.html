<!DOCTYPE html>



<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8" />

  <!-- Set the viewport width to device width for mobile -->
  <meta name="viewport" content="width=device-width" />
  <link rel="openid.server" href="http://openid.yubico.com/server.php" />
  <link rel="openid.delegate" href="http://openid.yubico.com/server.php/idpage?user=vvbdkthjbecc" />

   <title>HOWTO create a real menu trail in primary and secondary links</title>
   <meta name="author" content="Bèr ‘berkes’ Kessels" />
   <link href="http://feeds.feedburner.com/berkes" rel="alternate" title="HOWTO create a real menu trail in primary and secondary links Feed" type="application/atom+xml" />
   <link rel="author" href="/humans.txt" type="text/plain" />
   <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
   <!-- Included CSS Files -->
   <link rel='stylesheet' type='text/css' href='/bundles/66bfe58a92310a729441d3ebeed7faf2.css' />


   <!--[if lt IE 9]>
   <link rel='stylesheet' type='text/css' href='/bundles/5bf927c3c4faac96d17903f7ba5b378a.css' />

   <![endif]-->

   <script type='text/javascript' src='/bundles/2f42e0e43641f260414dd4eb0161fb9d.js'></script>


   <!-- IE Fix for HTML5 Tags -->
   <!--[if lt IE 9]>
   <script type='text/javascript' src='/bundles/69431f1ec831bacf31013dff2872cba0.js'></script>

   <![endif]-->
</head>
<body>
	<!-- container -->
	<div class="container">
    <header>
      <div class="row">
        <a href="/" title="Home">
          <img src="/assets//images/logo.png" alt="Logo" title="Bèr ‘berkes’ Kessels" />
        </a>
      </div>

      <nav id="main" class="row">
        <div class="onion">
        <ul>
          <li>
          <a href="/about.html">EN / About</a>
          </li>
          <li>
          <a href="/archive.html">EN / Articles</a>
          </li>
          <li>
          <a href="/over.html">NL / Over</a>
          </li>
          <li>
          <a href="/archief.html">NL / Artikelen</a>
          </li>
        </ul>
        </div>
      </nav>
    </header>
    <section id="main-content" class="row">
      <article>
  <header>
    <h1>HOWTO create a real menu trail in primary and secondary links</h1>
  </header> 
  <div class="body">
    <p>The menu system in Drupal is very complex, both from the inside and from the outside. One part of the menu is the  concept of primary and secondary links. these links are usually printed across the top of your page. The good news is that they are menu-items, like any other, the bad news is that the HTML is different from the other menu's.</p>

<p>One of the things I miss most is a class on the menu-items to distinguish expanded items from closed items.</p>

<p>I want my primary links to look like this: <br/>
<img src="http://webschuur.com/sites/webschuur.com/files/stella_active_tab_trail_thumb.png" alt="Expanded primary links with proper trail" />
<em><a href="http://webschuur.com/sites/webschuur.com/files/stella_active_tab_trail.png">zoom</a></em></p>

<p>When we are looking at a sub-page of <em>info</em>, I want <em>info</em> to represent that, by being "active" too.  Which requires a class set on the <em>list item</em>:</p>

<pre><code>&lt;ul id="primary"&gt;
  &lt;li&gt;&lt;a href="/agenda" &gt;agenda&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="/producties/voorstellingen/lopend" &gt;voorstellingen&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="/producties/projecten/lopend" &gt;projecten&lt;/a&gt;&lt;/li&gt;
  &lt;li class="active"&gt;&lt;a href="/info/stella_den_haag" &gt;info&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul id="secondary"&gt;
  &lt;li&gt;&lt;a href="/home"&gt;nieuws&lt;/a&gt;&lt;/li&gt;
  ...
  &lt;li&gt;&lt;a href="/wie-wij-zijn" class="active"&gt;wie wij zijn&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</code></pre>

<p>The most important part is the <em>class="active"</em> on the li in the top list. Note that Drupal does print a class="active" on the active menu, by default. You can see this in the bottom list, the last item. But it only does so on the active item, not on the trail. Drupal does not give that class to us, so we need to extract it from somewhere.</p>

<p>This is what it looks like with the Default Drupal output:  <br/>
<img src="http://webschuur.com/sites/webschuur.com/files/stella_active_tab_trail_broken_thumb.png" alt="Expanded primary links with no proper trail" /><br/>
<em><a href="http://webschuur.com/sites/webschuur.com/files/stella_active_tab_trail_broken.png">zoom</a></em></p>

<p>Luckily, Drupal returns keyed arrays to the theme layer, in <a href="http://api.drupal.org/api/4.7/function/menu_primary_links">menu_primary_links</a>   we see the following bit of code:</p>

<pre><code>foreach ($menu['visible'][$pid]['children'] as $cid) { 
   $index = "menu-$start_level-$count"; 
   if (menu_in_active_trail_in_submenu($cid, $pid)) { 
     $index .= "-active"; 
   } 
   $links[$index] = menu_item_link($cid); 
   $count++; 
 }
</code></pre>

<p>So we know that our index of the returned array with primary (and secondary) links contains the word "<em>-active</em>" if it appears in the active trail.</p>

<p>Just add this small function to your template.php, wich we can call to create proper classes from our indexes. (my theme is called "<em>stella</em>").</p>

<pre><code>function stella_menu_item_build_class($index) {
  //"menu-$start_level-$count" and optional -active appended
  $chunks = explode('-', $index);
  $class = "level-$chunks[1]";

  if ($chunks[3]) {
    $class .= " active";
  }

  return $class;
}
</code></pre>

<p>While we are at it, why not add some more <a href="http://www.quirksmode.org/css/multipleclasses.html">classes</a>?</p>

<p>Now we have a function, but still no classes in our lists. In <em>page.tpl.php</em>, where the menu-s are printed, we can use the function to create a class:</p>

<pre><code>&lt;ul id="primary"&gt;
  &lt;?php if (count($primary_links)) : ?&gt;
  &lt;?php foreach ($primary_links as $index =&gt; $link): ?&gt;
    &lt;li id="&lt;?php print $index ?&gt;" class="&lt;?php print stella_menu_item_build_class($index) ?&gt;"&gt;&lt;?php print $link ?&gt;&lt;/li&gt;
  &lt;?php endforeach; ?&gt;
  &lt;?php endif; ?&gt;
&lt;/ul&gt;
&lt;ul id="secondary"&gt;
  &lt;?php if (count($secondary_links)) : ?&gt;
  &lt;?php foreach ($secondary_links as $index =&gt; $link): ?&gt;
    &lt;?php $class = stella_menu_item_build_class($index) ?&gt;
    &lt;li id="&lt;?php print $index ?&gt;" class="&lt;?php print stella_menu_item_build_class($index) ?&gt;"&gt;&lt;?php print $link ?&gt;&lt;/li&gt;
  &lt;?php endforeach; ?&gt;
  &lt;?php endif; ?&gt;
&lt;/ul&gt;
</code></pre>

<p>Most important is the class, but the ID is worth mentioning too. While we are at it, let us just add the key as ID. It is unique after all.<br/>
But the most important part is <em>stella_menu_item_build_class($index)</em>. This is where we feed the indexes to the just created function and print that inside our <em>class=""</em> part.
Of course we must assign the key to the variable <em>$index</em> too. In PHP that is achieved with the <em>as $index => $link</em> in the foreach loop.</p>

<p>The result is usable HTML. But be aware that you are adding some overhead to each uncached page! The result can be seen on the <a href="http://staging.stella.nl">development site</a> of <a href="http://www.stella.nl">stella</a></p>

  </div>
  <footer>
    <p class="note">
    
      <em>This article was published on webschuur.com. And migrated to this blog. </em>
    
    </p>
    <time datetime="2006-10-13T00:00:00+02:00"
    pubdate="pubdate">
      Posted on 13 October 2006
    </time>
    in
    
    
      
      


  
    
      <a href="/tags.html#php-ref" class="black radius label">php<span class="size">41</span></a>
    
      <a href="/tags.html#tips and tricks-ref" class="black radius label">tips and tricks<span class="size">23</span></a>
    
      <a href="/tags.html#theming-ref" class="black radius label">theming<span class="size">25</span></a>
    
      <a href="/tags.html#css-ref" class="black radius label">css<span class="size">17</span></a>
    
      <a href="/tags.html#drupal-ref" class="black radius label">drupal<span class="size">214</span></a>
    
      <a href="/tags.html#stl_stella-ref" class="black radius label">stl_stella<span class="size">1</span></a>
    
  



    
  </footer>
</article>

<div id="author">
  <p>
  
  
    <strong>About  the author:</strong> Bèr Kessels is an experienced webdeveloper  with a great passion for
    technology and Open Source. A golden combination to implement that technology in a good and efficient
    way. Follow <a href="https://twitter.com/berkes">@berkes</a> on Twitter. Or read more <a href="/over.html">about Bèr</a>.
  
  </p>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'berkes'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

<hr/>
<aside>
  
  
  <h1>Read on:</h1>
  
  <ul>
    
      <li><span>February  4, 2014</span> &raquo; <a href="/2014/02/04/new-post">Uitgevers, geef mij niet de schuld, wanneer ik mijn ebooks niet van jullie koop!</a></li>

    
      <li><span>November 28, 2013</span> &raquo; <a href="/2013/11/28/olaf-van-den-heuvel-is-een-maximum-flapdrol">Olaf van den Heuvel is een maximum flapdrol</a></li>

    
      <li><span>November 27, 2013</span> &raquo; <a href="/2013/11/27/hoe-kom-ik-aan-bitcoin-en-een-bitcoin-rekening">Hoe kom ik aan Bitcoin, en een Bitcoin rekening?</a></li>

    
  </ul>
</aside>


    </section>

    <footer class="main row">
      <div class="contact four columns">
        <p>
            Bèr ‘berkes’ Kessels<br />
            Bèr Kessels is an Open Source Webdeveloper.<br />
            <a href='mailto:ber@berk.es'>ber@berk.es</a>
          </p>
          <p>
            <a href="http://github.com/berkes/">github.com/berkes</a><br />
            <a href="http://twitter.com/berkes/">twitter.com/berkes</a><br />
          </p>
      </div>
      <div class="four columns">
        Copyright 2001-2014
        with a
        <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license">Creative Commons Attribute-Share-alike 3.0 Unported license</a>
      </div>
      <div class="four columns">
        <a class="extra" href="/archive.html">Archive (All English articles)</a> <br />
        <a class="extra" href="/archief.html">Archief (Alle Nederlandse artikelen)</a> <br />
        <a class="extra" href="/tags.html">Tags</a> <br />
        <a href="http://feeds.feedburner.com/berkes"> RSS </a> <br />
      </div>
    </footer>
  </div>
  <!-- Piwik -->
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://piwik.webschuur.com/" : "http://piwik.webschuur.com/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 9);
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
</script><noscript><p><img src="http://piwik.webschuur.com/piwik.php?idsite=9" style="border:0" alt="" /></p></noscript>
<!-- End Piwik Tracking Code -->

</body>
</html>
