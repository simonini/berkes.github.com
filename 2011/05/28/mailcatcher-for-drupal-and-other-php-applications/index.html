<!DOCTYPE html>



<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8" />

  <!-- Set the viewport width to device width for mobile -->
  <meta name="viewport" content="width=device-width" />
  <link rel="openid.server" href="http://www.myopenid.com/server" />
  <link rel="openid.delegate" href="http://berkes.myopenid.com/" />
  <link rel="openid2.local_id" href="http://berkes.myopenid.com" />
  <link rel="openid2.provider" href="http://www.myopenid.com/server" />
  <meta http-equiv="X-XRDS-Location" content="http://www.myopenid.com/xrds?username=berkes.myopenid.com" />

   <title>Mailcatcher for Drupal and other PHP-applications</title>
   <meta name="author" content="Bèr ‘berkes’ Kessels" />
   <link href="http://feeds.feedburner.com/berkes" rel="alternate" title="Mailcatcher for Drupal and other PHP-applications Feed" type="application/atom+xml" />
   <link rel="author" href="/humans.txt" type="text/plain" />
   <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
   <!-- Included CSS Files -->
   <link rel='stylesheet' type='text/css' href='/bundles/66bfe58a92310a729441d3ebeed7faf2.css' />


   <!--[if lt IE 9]>
   <link rel='stylesheet' type='text/css' href='/bundles/5bf927c3c4faac96d17903f7ba5b378a.css' />

   <![endif]-->

   <script type='text/javascript' src='/bundles/2f42e0e43641f260414dd4eb0161fb9d.js'></script>


   <!-- IE Fix for HTML5 Tags -->
   <!--[if lt IE 9]>
   <script type='text/javascript' src='/bundles/69431f1ec831bacf31013dff2872cba0.js'></script>

   <![endif]-->
</head>
<body>
	<!-- container -->
	<div class="container">
    <header>
      <div class="row">
        <a href="/" title="Home">
          <img src="/assets//images/logo.png" alt="Logo" title="Bèr ‘berkes’ Kessels" />
        </a>
      </div>

      <nav id="main" class="row">
        <div class="onion">
        <ul>
          <li>
          <a href="/about.html">EN / About</a>
          </li>
          <li>
          <a href="/archive.html">EN / Articles</a>
          </li>
          <li>
          <a href="/over.html">NL / Over</a>
          </li>
          <li>
          <a href="/archief.html">NL / Artikelen</a>
          </li>
        </ul>
        </div>
      </nav>
    </header>
    <section id="main-content" class="row">
      <article>
  <header>
    <h1>Mailcatcher for Drupal and other PHP-applications</h1>
  </header> 
  <div class="body">
    <p><strong>UPDATE</strong> Please see the <a href="/2011/05/29/mailcatcher-for-drupal-and-other-php-applications-the-simple-version/">newer version of this article</a>, the latest malcatcher has its own sendmail replacement, making installation for PHP a lot simpler.</p>

<p><strong>Problem:</strong> on development (and test) you don't want to send out mail. But you /do/ want to test it. You certainly don't want to be in my shoes when a client called me, telling she recieved dozens of confused and angry mails from users on her site, after I fired up cron on my local development machine. And sent out approximately 3000 notification mails to users, with stuff like "new post for you: "W000t, fieldz0rz developmentz in CCK is workinggggg!". Not cool.</p>

<p><strong>Problem:</strong> when debugging mail, you want to inspect the headers and the source (in case of multipart or HTML mail). Most emailclients are crap for that (and right so: who other then the odd mail/webdeveloper needs to inspect the source of a mail. ever?)</p>

<p><strong>Solution:</strong> the brilliant Ruby application named <a href="https://github.com/sj26/mailcatcher">mailcatcher</a>. This is a simple SMTP server, which shows the mails sent to it, in a handy webapplication. The webapplication features debug-tools such as headers, and source displaying.</p>

<p><img src="/images/inline/mailcatcher.png" alt="Screenshot of a Drupal password recorvery mail in Mailcatcher" /></p>

<p>Additional problem: PHP on none-windows machines, cannot deliver mail to an arbitrary SMTP server. It requires a sendmail program being invoked somewhere. Drupal does not allow sending mail to any smtp server without additional configuration. Solution for that is the ultralight sendmail alternative <a href="http://msmtp.sourceforge.net">msmtp</a>. If we configure msmtp to act as sendmail and deliver mail to mailcatcher, we are fine: <em>Drupal » PHP mail() » /bin/msmtp --foo --bar » Mailcatcher</em></p>

<p>Aside: Windows. It is probably possible, but since using even the most basic proper commandline on there requires lots of hassle, all this is far from as trivial as Mac and Linux. I am sorry, but please use the comments if you go mailcatcher running with PHP on Windows.</p>

<h2>Mac</h2>

<p>Install mailcatcher (Use sudo for installing systemwide).
<code>$ gem install mailcatcher</code></p>

<p>Install msmtp, using MacPorts.
<code>$ sudo port install msmtp</code></p>

<p>Configure PHP to use msmtp for delivering mail:</p>

<ul>
<li>Edit <em>php.ini</em></li>
<li><p>Under <em>[mail function]</em>, if available, change the <em>sendmail_path</em> variable. Else just add it to
<em>php.ini</em>.</p>

<p>  sendmail_path = "/usr/bin/msmtp -t "</p></li>
</ul>


<p>And restart apache.</p>

<p><a href="http://masterleep.com/2010/configuring-msmtp-on-osx-snow-leopard-to-send-through-gmail">Configure msmtp</a> with some defaults (this file should probably be named <em>/etc/msmtprc</em>)</p>

<pre><code>account mailcatcher
host localhost  
port 1025       # MailCatcher will tell you the port it listens to.
# Enable logfile for additional troubleshooting.
# logfile /var/log/msmtp.log
auto_from on    # From does not work 100% with me, yet, because the envolope-from 
                # is still wrong. But leaving this out makes msmtp fail with PHP.

account default: mailcatcher 
</code></pre>

<p>Start up mailcatcher
<code>$ mailcatcher</code></p>

<p>Open your browser and visit http://localhost:1080</p>

<h2>Linux (Ubuntu, Debian and derivatives)</h2>

<p>install ruby and rubygems first (if you don't already have it)
<code>$ sudo apt-get install ruby rubygems</code>
Then install mailcatcher.
<code>$ gem install mailcatcher</code></p>

<p>Install msmtp.
<code>$ sudo port install msmtp</code></p>

<p>Configure PHP to use msmtp for delivering mail:</p>

<ul>
<li>Edit <em>/etc/php5/apache2/php.ini</em></li>
<li><p>Under <em>[mail function]</em>, change the <em>sendmail_path</em> variable.</p>

<p>  sendmail_path = "/usr/bin/msmtp -t "</p></li>
</ul>


<p>And restart apache (<em>$sudo service apache2 restart</em>) to load the new php.ini.</p>

<p><a href="http://serverfault.com/questions/235723/testing-php-mail-in-localhost-problem">Configure msmtp so it accepts PHPs sendmail calls</a> with some defaults. Edit <em>/etc/msmtprc</em>.</p>

<pre><code>account mailcatcher
host localhost  
port 1025       # MailCatcher will tell you the port it listens to.
auto_from on    # From does not work 100% with me, yet, because the envolope-from 
                # is still wrong. But leaving this out makes msmtp fail with PHP.

account default: mailcatcher 
</code></pre>

<p>Start up mailcatcher
<code>$ mailcatcher</code></p>

<p>Open your browser and visit http://localhost:1080</p>

<h2>Troubleshooting</h2>

<p>If things don't work out, check the main apache error log. Errors by msmtp will show up there and tell you what went wrong. Use the Logs Luke, use the logs!</p>

<p>You can turn on msmtp logging with <em>logfile /var/log/msmtp.log</em> in <em>msmtprc</em>. No need to restart apache for that. Msmtp will tell you what calls it recieved and what parameters it got.</p>

<p>Cut out PHP and <a href="http://serverfault.com/questions/235723/testing-php-mail-in-localhost-problem">send a mail with msmtp</a> to mailcatcher on the commandline</p>

<pre><code>echo -e "Subject: Test Mail\r\n\r\nThis is a test mail" |msmtp --debug --from=default -t me@example.com
</code></pre>

<p>If that works, then the problem is between Drupal/PHP and msmtp, and the apache-logs should give a hint (see above).</p>

<h2>Mailcatcher gotcha's and tips</h2>

<ul>
<li>Just terminate (<sup>C-c)</sup> mailcatcher and restart it to flush the recieved mail.</li>
<li>On firefox (4) the web interface from mailcatcher did not look that well. Chrome(ium) rendered it fine, though.</li>
<li>Don´t forget to start up mailcatcher before you start hacking along on your site, If you forget it, mail will not be sent out, but will fail and PHP (Drupal) will give errors on mailing.</li>
</ul>


<p><strong>Happy Mailing on your development machine!</strong></p>

  </div>
  <footer>
    <p class="note">
    
      <em>This article was published on webschuur.com. And migrated to this blog. </em>
    
    </p>
    <time datetime="2011-05-28T00:00:00+02:00"
    pubdate="pubdate">
      Posted on 28 May 2011
    </time>
    in
    
    
      
      


  
    
      <a href="/tags.html#php-ref" class="black radius label">php<span class="size">41</span></a>
    
      <a href="/tags.html#drupal-ref" class="black radius label">drupal<span class="size">214</span></a>
    
      <a href="/tags.html#drupal-ref" class="black radius label">drupal<span class="size">214</span></a>
    
      <a href="/tags.html#drupal blog-ref" class="black radius label">drupal blog<span class="size">11</span></a>
    
      <a href="/tags.html#ruby-ref" class="black radius label">ruby<span class="size">25</span></a>
    
      <a href="/tags.html#ruby on rails-ref" class="black radius label">ruby on rails<span class="size">14</span></a>
    
  



    
  </footer>
</article>

<div id="author">
  <p>
  
  
    <strong>About  the author:</strong> Bèr Kessels is an experienced webdeveloper  with a great passion for
    technology and Open Source. A golden combination to implement that technology in a good and efficient
    way. Follow <a href="https://twitter.com/berkes">@berkes</a> on Twitter. Or read more <a href="/over.html">about Bèr</a>.
  
  </p>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'berkes'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>


    </section>

    <footer class="main row">
      <div class="contact four columns">
        <p>
            Bèr ‘berkes’ Kessels<br />
            Bèr Kessels is an Open Source Webdeveloper.<br />
            <a href='mailto:ber@berk.es'>ber@berk.es</a>
          </p>
          <p>
            <a href="http://github.com/berkes/">github.com/berkes</a><br />
            <a href="http://twitter.com/berkes/">twitter.com/berkes</a><br />
          </p>
      </div>
      <div class="four columns">
        Copyright 2001-2013
        with a
        <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license">Creative Commons Atrribute-Share-alike 3.0 Unported license</a>
      </div>
      <div class="four columns">
        <a class="extra" href="/archive.html">Archive (All English articles)</a> <br />
        <a class="extra" href="/archief.html">Archief (Alle Nederlandse artikelen)</a> <br />
        <a class="extra" href="/tags.html">Tags</a> <br />
        <a href="http://feeds.feedburner.com/berkes"> RSS </a> <br />
      </div>
    </footer>
  </div>
  <!-- Piwik -->
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://piwik.webschuur.com/" : "http://piwik.webschuur.com/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 9);
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
</script><noscript><p><img src="http://piwik.webschuur.com/piwik.php?idsite=9" style="border:0" alt="" /></p></noscript>
<!-- End Piwik Tracking Code -->

</body>
</html>
